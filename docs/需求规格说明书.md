# 城市动保协同平台（Spring Boot 2.7.6 + Vue2）需求规格说明书

- 文档版本：v0.1
- 编写日期：2026-02-05
- 适用范围：Web 端（PC/移动浏览器），前后端分离

## 1. 背景与目标

城市动物保护工作涉及公众上报、执法处置、救助医疗、后续领养与监管统计等多主体协作。现状常见问题包括：信息分散、部门割裂、反馈滞后、证据难留存、过程不可追踪。

本平台目标：以统一数据体系 + 事件驱动机制为底座，构建“事件上报—执法处理—救助医疗—统计监管”的闭环治理平台，支撑多角色并发访问下的权限控制、数据隔离与性能可扩展。

## 2. 范围与边界

### 2.1 覆盖范围（本期）

- 四端：公众用户端、执法部门端、救助医疗机构端、系统管理员端
- 核心闭环：
  1) 公众上报事件 → 2) 分流/受理 → 3) 执法/救助协同处置 → 4) 结果反馈与公示 → 5) 归档与统计监管
- 支撑能力：用户与组织管理、RBAC 权限、地图定位、附件存储、消息通知、审核流程、统计报表

### 2.2 暂不包含（可列入后续迭代）

- 原生 App（仅浏览器端）
- AI 识别（动物种类/伤情/风险预测）仅作为可选扩展点，不作为验收硬指标
- 复杂财务审计、发票开具对接（仅提供捐赠记录与公开披露）

## 3. 角色、组织与多端定义

### 3.1 组织类型

- 执法部门：区/街道/分局等（具备区域管辖）
- 救助医疗机构：救助站、动物医院、合作 NGO（具备接单/抢单能力）
- 平台方：系统管理员（平台级配置与监管）

### 3.2 用户角色（四端）

本系统按“四端”仅设置 4 类用户角色（与端功能严格对应）：

- 公众用户：对应公众用户端（10 项功能）。其中“注册志愿者”属于公众用户的子身份，用于执行任务认领与巡护上报等能力。
- 执法部门：对应执法部门端（5 项功能）。
- 救助医疗机构：对应救助医疗机构端（6 项功能）。
- 系统管理员：对应系统管理员端（4 项功能）。

> 说明：本文档不再细分到组织内部岗位（如执法人员/调度员/兽医/库管等）。组织内的岗位差异可通过“系统管理员端-权限配置”在实现阶段落地，但不作为需求层角色拆分。

## 4. 核心业务闭环与事件驱动

### 4.1 核心对象

- 事件（Event）：公众/志愿者发起的上报，包含时间、地点、类型、描述、附件等
- 工单（Work Order）：平台对事件的处置单元，面向执法或救助；可一事件多工单
- 救助任务（Rescue Task）：机构侧执行单元，包含调度、到场、入站等
- 动物档案（Animal Profile）：入站/治疗对象的主数据，贯穿治疗、领养、回访
- 案件（Case）：执法侧对违法行为的处置记录与归档

### 4.2 业务流程（与流程图一致）

平台闭环以“公众上报事件”为起点，按业务判断进入执法处置与/或救助医疗，并在关键节点向公众推送反馈，管理员进行数据监控与统计。

1) 公众用户上报事件（系统记录时间与位置）  
2) 执法部门接收工单，并进行业务判断：是否需执法  
3) 如需执法：现场取证 → 结果录入（并公示）→ 案件归档  
4) 执法处置过程中/处置后判断：是否需转送救助医疗机构  
5) 如需转送：救助医疗机构接收事件，并评估是否救助  
6) 如需救助：救助调度 → 动物建档 → 治疗记录  
7) 执法或救助形成阶段性/最终结果后：推送反馈 → 公众用户查看反馈  
8) 系统管理员：查看数据监控 → 统计报表

### 4.2 状态机（建议）

#### 4.2.1 事件状态（EventStatus）

- REPORTED：已上报（待分流/初审）
- TRIAGED：已分流（确定责任部门/机构）
- DISPATCHED：已派单（生成工单/任务）
- PROCESSING：处理中（到场/救助/执法推进）
- PENDING_SUPPLEMENT：待补充（需要公众/志愿者补充线索）
- RESOLVED：已处置（救助完成/执法结果形成）
- CLOSED：已闭环（归档，允许评价/回访跟进）
- REJECTED：不予受理（需给出原因与证据）
- DUPLICATE：重复事件（与既有事件合并）

#### 4.2.2 工单状态（WorkOrderStatus）

- NEW → ACCEPTED/REJECTED → ASSIGNED → ON_SITE → FINISHED → ARCHIVED

#### 4.2.3 救助任务状态（RescueTaskStatus）

- NEW/GRABBED → DISPATCHING → ARRIVED → INTAKE → TREATING → HANDOVER/RELEASED → CLOSED

### 4.3 事件驱动机制（需求层定义）

系统需在关键节点产生“领域事件”，用于异步通知、统计聚合、流程推进与审计留痕。

- EventReported：事件上报完成
- EventUpdated：事件信息补充/变更
- WorkOrderCreated / Assigned / Accepted / Finished
- RescueTaskCreated / Grabbed / Arrived / IntakeCompleted / TreatmentUpdated / Closed
- CaseResultPublished：执法结果公示
- AdoptionApplied / Approved / Rejected / FollowUpSubmitted
- DonationSucceeded

要求：
- 领域事件需可追溯（事件ID、触发人、时间、来源端、关联对象ID）
- 事件触发的通知、统计与流程动作需幂等（避免重复推送/重复统计）

## 5. 功能需求

### 5.1 通用支撑能力（跨端，非端功能清单）

**FR-COM-01 账号与登录**
- 支持手机验证码登录；可扩展第三方登录（微信/政务统一认证）
- 支持退出登录、找回/重置（如启用密码）

**FR-COM-02 地图与定位**
- 上报/任务/巡护需支持地图选点、自动定位、地址逆解析
- 位置数据需保存：经纬度、行政区划（省市区）、地址文本

**FR-COM-03 附件管理**
- 支持图片/视频上传；生成缩略图；限制大小与类型
- 附件与业务对象绑定（事件/工单/病历/回访等），支持权限控制

**FR-COM-04 消息中心与通知**
- 站内消息：状态变更通知、处理进度反馈
- 可配置外部通知渠道：短信/邮件/微信模板（可选）

**FR-COM-05 搜索与筛选**
- 事件、工单、动物、领养、内容支持关键词搜索与多条件筛选

**FR-COM-06 审计与操作日志**
- 关键操作（派单、取证、结果录入、病历共享、权限变更、审核结论）必须记录日志

### 5.2 公众用户端

**FR-PUB-01 事件上报**
- 公众可通过图文、视频、定位等方式上报流浪动物、受伤动物等事件
- 系统自动记录上报时间与位置

**FR-PUB-02 事件跟进**
- 事件详情展示：当前状态、处理记录时间线、责任单位/机构（可脱敏）、反馈信息
- 接收系统推送的反馈信息，并查看事件处理进度

**FR-PUB-03 线索补充**
- 允许补充描述、追加附件、补充时间地点信息
- 补充记录需纳入事件时间线

**FR-PUB-04 互动评论**
- 用户可在事件下留言评论，并与其他用户互动

**FR-PUB-05 志愿者任务认领**
- 注册志愿者可在线领取巡护或救助任务

**FR-PUB-06 巡护上报**
- 志愿者在执行任务后上传轨迹与风险点
- 支持预警分析（预警模型/规则在后续设计中落地）

**FR-PUB-07 动物领养**
- 公众可浏览可领养动物并提交领养申请

**FR-PUB-08 回访管理**
- 领养后填写问卷并上传回访资料

**FR-PUB-09 公益捐助**
- 公众可按事件或机构进行定向捐赠

**FR-PUB-10 动保课堂**
- 提供动物保护知识的短视频与图文内容

### 5.3 执法部门端

**FR-LAW-01 工单受理**
- 接收公众上报或系统生成的执法工单
- 受理时需判断是否需执法；如不需执法需给出处理结论，并按规则决定是否转送救助医疗机构或直接反馈

**FR-LAW-02 任务分派**
- 按区域和类型将工单派发给对应执法人员

**FR-LAW-03 现场取证**
- 执法人员现场拍照取证并上传记录

**FR-LAW-04 结果录入与公示**
- 录入处罚结果并公示

**FR-LAW-05 案件归档与统计**
- 形成电子档案并纳入统计系统
- 案件处置过程中/处置后如需转送救助医疗机构，应形成可追溯的转送记录并触发机构端“任务接收”

### 5.4 救助医疗机构端

**FR-RES-01 任务接收/抢单**
- 接收或抢单救助任务
- 接收后需评估是否救助；如不予救助需给出结论并推送反馈

**FR-RES-02 救助调度**
- 调度车辆与人员并监控进度

**FR-RES-03 动物建档**
- 为入站动物建立体检档案

**FR-RES-04 治疗记录**
- 记录动物的诊疗、用药与康复信息

**FR-RES-05 病历共享与远程会诊**
- 支持电子病历共享与远程会诊

**FR-RES-06 库存管理**
- 对物资药品进行库存统计与预警

### 5.5 系统管理员端

**FR-ADM-01 数据监控大屏**
- 通过可视化大屏查看全域事件动态

**FR-ADM-02 统计报表**
- 生成多维度数据分析与图表

**FR-ADM-03 权限配置（RBAC）**
- 设置不同角色的访问与操作权限

**FR-ADM-04 审核管理（流程引擎需求）**
- 定义并维护多级审核流程

## 6. 权限与数据隔离（关键要求）

### 6.1 权限模型

- 采用 RBAC（角色-权限）为主，叠加数据范围（Data Scope）控制
- 数据范围建议：
  - SELF：仅本人
  - ORG：本组织
  - ORG_AND_CHILD：本组织及下级
  - REGION：指定行政区
  - ALL：全域（平台管理员）

### 6.2 典型隔离规则（最低要求）

- 公众（含注册志愿者子身份）：仅可见自己上报/参与的事件必要信息；对其他事件仅可见脱敏公开信息（如开放浏览）
- 执法：可见辖区内事件/工单；可见证据与案件字段；对公众端展示字段必须脱敏
- 机构：可见接单任务及关联动物档案；病历共享需授权；不可越权查看其他机构动物信息
- 管理员：按分配范围查看全域数据；权限变更与审核流程维护须记录审计日志

## 7. 数据需求（概念模型与字段要点）

> 本节为需求层“统一数据体系”的落地说明，后续可转为 ER 图与数据字典。

### 7.1 主要实体

- User：id、手机号、昵称、实名状态、角色集合、所属组织、状态
- Organization：id、类型（执法/机构/平台）、名称、区域、联系人、能力标签
- Event：id、类型、紧急程度、描述、位置（lat/lng、地址、区域码）、状态、创建人、时间线
- EventTimeline：eventId、节点类型、内容、操作者、时间、附件
- WorkOrder：id、eventId、受理部门、负责人、状态、SLA、结果摘要
- Case：id、workOrderId、法律依据、处罚结果、公示字段、归档包引用
- RescueTask：id、eventId、机构、调度信息、状态、节点时间
- AnimalProfile：id、rescueTaskId、物种/品种、照片、体况、健康状态、领养状态
- MedicalRecord：id、animalId、诊疗记录、用药、检验、附件、共享授权
- InventoryItem：id、名称、规格、批次、有效期、库存、阈值、出入库流水
- Adoption：id、animalId、申请人、审批状态、协议、回访计划
- FollowUp：id、adoptionId、问卷、附件、提交时间、状态
- Donation：id、捐赠人（可匿名）、目标（事件/机构）、金额、时间、支付状态、披露内容
- Content：id、类型（图文/视频）、分类、标题、正文/视频地址、发布状态
- Comment：id、eventId、作者、内容、父评论、状态（正常/屏蔽/删除）

### 7.2 统一编码与枚举（建议）

- EventType：流浪动物、受伤动物、虐待线索、扰民纠纷、疑似传染病、其他
- Urgency：低/中/高/紧急
- RiskPointType：聚集点、投喂点、伤病点、争议点、疑似毒害点
- PublicVisibility：公开/仅本人可见/仅参与方可见

## 8. 非功能需求

### 8.1 安全

- 身份认证：JWT 会话；关键操作二次确认（可选）
- 防越权：接口级鉴权 + 数据范围校验
- 防刷与风控：验证码/限流（登录、上报、评论、捐赠回调等）
- 重要数据加密：敏感字段（手机号、身份证等）加密存储（如启用实名）

### 8.2 隐私与合规

- 最小化采集：仅采集业务必要信息；明确告知用途
- 附件与位置：可配置保留期；对外展示需脱敏
- 审计：权限变更与敏感访问必须可追溯

### 8.3 性能与可用性（建议指标）

- 99% 请求响应时间：< 1s（常规查询）；< 3s（含地图聚合/报表）
- 并发：支持至少 500 并发在线（可按城市规模调整）
- 附件上传：支持断点续传（可选）与 CDN 分发（可选）

### 8.4 可靠性

- 关键数据备份：每日备份；支持按事件/动物快速恢复
- 消息与事件：至少一次投递语义；消费端幂等

### 8.5 可运维性

- 日志：业务日志、审计日志、性能日志
- 监控：QPS、错误率、慢查询、队列堆积、存储容量、附件访问

### 8.6 兼容性

- 浏览器：Chrome/Edge（近两年版本）；移动端浏览器适配主流安卓/iOS

## 9. 里程碑（建议分期交付）

### 9.1 MVP（闭环优先）

- 事件上报与跟进、工单受理与派单、救助任务接收与进度回写、管理员大屏与基础报表
- 基础 RBAC 与数据隔离、附件、消息中心

### 9.2 第 2 期

- 动物建档 + 治疗记录 + 库存管理
- 领养申请 + 回访
- 捐赠（含公开披露）

### 9.3 第 3 期

- 病历共享与远程会诊
- 高级统计与预警分析（风险点、热力趋势、SLA 分析）

## 10. 验收标准（示例场景）

- AC-01：公众上报（含定位+图片）→ 执法部门接收工单并判断“是否需执法” →（需执法）现场取证并录入结果、公示与归档 → 推送反馈 → 公众端查看反馈与时间线
- AC-02：救助机构抢单 → 调度到场 → 入站建档 → 更新治疗记录 → 状态回写事件时间线 → 管理端报表可统计到场时长与闭环数量
- AC-02a：执法部门判断“是否需转送救助医疗机构” →（需转送）机构端接收事件并评估“是否救助” →（需救助）调度、建档、治疗记录 → 推送反馈 → 公众端可查看救助进展
- AC-03：志愿者领取巡护任务 → 上传轨迹与风险点 → 管理端可按区域查看风险点分布与趋势
- AC-04：领养申请提交 → 审核通过 → 自动生成回访任务 → 公众按期提交回访材料 → 机构可查看回访完成率
- AC-05：权限隔离：不同机构/不同辖区执法账号互不可见对方敏感数据；越权访问被拒绝并留审计日志

## 11. 术语表

- 事件：公众/志愿者上报的业务起点
- 工单：面向执法/处置的办理单元
- 救助任务：机构侧执行单元
- 闭环：事件从上报到归档的全流程可追溯与可反馈
- 数据范围：在 RBAC 基础上对“能看哪些数据”的约束（本人/组织/区域/全域）

---

> 说明：本需求文档为 v0.1，用于立项与原型/接口设计输入。后续建议补充：页面原型、字段级数据字典、流程泳道图、接口清单与权限矩阵。
